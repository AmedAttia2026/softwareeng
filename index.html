<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Educational Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Base font size for the entire document, relative to which all 'rem' units will scale */
        html {
            font-size: 16px; /* تم زيادة الحجم حسب الطلب ليكون أكثر وضوحًا على شاشات الهاتف */
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #F8F9FA; /* Page Background */
            color: #3A3A3A; /* Darker text for better readability */
            line-height: 1.6;
            font-size: 1rem; /* A more readable font size */
            transition: font-size 0.2s ease-in-out;
        }

        /* Fixed header for easy access */
        .header-bg {
            background-color: #007BFF;
            color: white;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            padding: 0.75rem; /* تم تعديل المساحة */
            position: fixed;
            width: 100%;
            top: 0;
            left: 0;
            z-index: 20;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .header-bg h1 {
            font-size: 1.25rem; /* تم تعديل حجم الخط */
            font-weight: 700;
        }

        .main-container {
            padding-top: 4rem; /* Add padding to prevent content from being hidden by the fixed header */
            padding-bottom: 1.5rem;
        }

        /* Hamburger menu icon for the sidebar */
        .hamburger-menu {
            display: block;
            cursor: pointer;
            padding: 0.25rem;
        }

        .hamburger-menu svg {
            width: 24px; /* تم تعديل الحجم */
            height: 24px;
        }

        /* Sidebar styles */
        .sidebar {
            position: fixed;
            left: -200px; /* تم تكبير حجم الشريط الجانبي */
            width: 200px; /* تم تكبير حجم الشريط الجانبي */
            height: 100%;
            background-color: #f8f9fa;
            color: #3A3A3A;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.2);
            transition: left 0.3s ease;
            z-index: 30;
            display: flex;
            flex-direction: column;
            padding: 0.5rem 0; /* تم تعديل المساحة */
            top: 0;
        }

        .sidebar.active {
            left: 0; /* Slide in from the left */
        }

        .sidebar-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 25;
            display: none;
        }
        .sidebar-backdrop.active {
            display: block;
        }

        .sidebar-header {
            padding: 0.75rem; /* تم تعديل المساحة */
            font-size: 1.1rem; /* تم تعديل حجم الخط */
            font-weight: bold;
            border-bottom: 1px solid #e0e0e0;
            margin-bottom: 0.5rem;
            text-align: center;
        }

        .sidebar-nav-item {
            display: flex;
            align-items: center;
            padding: 0.85rem 1rem; /* تم تكبير المساحة */
            font-size: 1.1rem; /* تم تكبير حجم الخط */
            color: #4A5568;
            transition: background-color 0.2s ease, color 0.2s ease;
            cursor: pointer;
            border-bottom: 1px solid #e0e0e0;
        }
        .sidebar-nav-item:hover, .sidebar-nav-item.active {
            background-color: #E2E8F0;
            color: #007BFF;
        }

        /* General quiz card and button styles */
        .card {
            background-color: #FFFFFF;
            border-radius: 0.75rem;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.12);
            margin-bottom: 1.75rem; /* تم تعديل المساحة */
            padding: 1.5rem; /* تم تعديل المساحة */
            border: 1px solid #E0E0E0;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        .question-text {
            font-size: 1.1rem; /* تم تعديل حجم الخط */
            font-weight: 700;
            color: #424242;
            margin-bottom: 1.25rem; /* تم تعديل المساحة */
            line-height: 1.6;
        }
        .action-button {
            background-color: #007BFF;
            color: white;
            padding: 0.75rem 1.5rem; /* تم تعديل المساحة */
            border-radius: 0.5rem;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            margin-top: 1.5rem; /* تم تعديل المساحة */
            font-weight: 600;
            box-shadow: 0 3px 6px rgba(0, 123, 255, 0.2);
            display: inline-block;
            margin-left: 0.5rem; /* تم تعديل المساحة */
            margin-right: 0.5rem; /* تم تعديل المساحة */
        }
        .action-button:hover {
            background-color: #0056b3;
            transform: translateY(-1px);
            box-shadow: 0 5px 10px rgba(0, 123, 255, 0.3);
        }
        .answer-text {
            color: #28A745;
            font-weight: 700;
            margin-top: 1rem; /* تم تعديل المساحة */
            display: none;
            font-size: 1.1rem; /* تم تعديل حجم الخط */
        }
        .mcq-option {
            display: flex;
            align-items: center;
            margin-bottom: 0.9rem; /* تم تعديل المساحة */
            cursor: pointer;
            position: relative;
            padding: 0.75rem 1rem; /* تم تعديل المساحة */
            border-radius: 0.4rem;
            transition: background-color 0.2s ease, box-shadow 0.2s ease, transform 0.1s ease-out;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.04);
            border: 1px solid #E0E0E0;
            
            /* Enhanced Clickable Area */
            position: relative;
            z-index: 1; /* Ensure it's above other elements if needed */
        }
        .mcq-option::before {
            content: '';
            position: absolute;
            top: -3px; /* Adjust as needed */
            bottom: -3px; /* Adjust as needed */
            left: -3px; /* Adjust as needed */
            right: -3px; /* Adjust as needed */
            z-index: 0;
            cursor: pointer;
        }
        .mcq-option:hover {
            background-color: #F5F5F5;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .mcq-option:active {
            transform: scale(0.99);
            box-shadow: 0 1px 1px rgba(0, 0, 0, 0.1);
        }
        .mcq-option input[type="radio"] {
            position: absolute;
            opacity: 0;
            left: 0;
            top: 0;
            cursor: pointer;
            z-index: 2;
        }
        .mcq-option label {
            display: flex;
            align-items: center;
            font-size: 1rem; /* تم تعديل حجم الخط */
            color: #333;
            line-height: 1.5;
            padding-left: 2rem; /* تم تعديل المساحة */
            flex-grow: 1;
            position: relative;
            cursor: pointer;
            height: 100%;
            width: 100%;
        }
        .mcq-option label::before {
            content: '';
            position: absolute;
            left: 0.25rem;
            top: 50%;
            transform: translateY(-50%);
            height: 1.5rem; /* تم تعديل الحجم */
            width: 1.5rem; /* تم تعديل الحجم */
            border: 2px solid #007BFF;
            border-radius: 50%;
            background: #fff;
            transition: all 0.2s ease;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
            z-index: 1;
        }
        .mcq-option label::after {
            content: '';
            position: absolute;
            left: 0.65rem; /* تم تعديل المساحة */
            top: 50%;
            transform: translateY(-50%);
            height: 0.8rem; /* تم تعديل الحجم */
            width: 0.8rem; /* تم تعديل الحجم */
            border-radius: 50%;
            background: #007BFF;
            opacity: 0;
            transition: opacity 0.2s ease;
            z-index: 1;
        }
        .mcq-option input[type="radio"]:checked + label::after {
            opacity: 1;
        }
        .mcq-option input[type="radio"]:checked + label::before {
            border-color: #007BFF;
            background-color: #E6F2FF;
        }
        .mcq-option:hover label::before {
            border-color: #0056b3;
        }
        .score-display {
            margin-top: 1.5rem; /* تم تعديل المساحة */
            font-weight: 700;
            color: #3A3A3A;
            font-size: 1.6rem; /* تم تعديل حجم الخط */
            text-align: center;
        }
        .final-score-message {
            font-size: 2.2rem; /* تم تعديل حجم الخط */
            font-weight: 800;
            color: #007BFF;
            margin-top: 1.75rem; /* تم تعديل المساحة */
            text-align: center;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.1);
        }
        .correct-answer-highlight {
            color: #28A745;
        }
        .incorrect-answer-highlight {
            color: #DC3545;
        }
        .question-feedback {
            font-size: 1rem; /* تم تعديل حجم الخط */
            margin-top: 0.75rem; /* تم تعديل المساحة */
            font-weight: 600;
        }
        .option-correct-highlight {
            background-color: #D1FAE5;
            border-color: #059669;
        }
        .option-incorrect-highlight {
            background-color: #FEE2E2;
            border-color: #DC2626;
        }
        .mcq-option.selected-for-review label::after,
        .mcq-option.correct-for-review label::after {
            opacity: 1;
        }
        .mcq-option.selected-for-review label::before,
        .mcq-option.correct-for-review label::before {
            border-color: #007BFF;
            background-color: #E6F2FF;
        }
        .mcq-option.selected-for-review.option-incorrect-highlight label::before {
            border-color: #DC3545;
            background-color: #FEE2E2;
        }
        .mcq-option.selected-for-review.option-incorrect-highlight label::after {
            background: #DC3545;
        }
        .fab-container {
            position: fixed;
            bottom: 1rem; /* تم تعديل المساحة */
            right: 1rem; /* تم تعديل المساحة */
            display: flex;
            flex-direction: column-reverse;
            gap: 0.5rem;
            z-index: 1000;
        }
        .fab-button {
            background-color: #007BFF;
            color: white;
            padding: 0.6rem; /* تم تعديل المساحة */
            border-radius: 9999px;
            box-shadow: 0 3px 5px rgba(0, 0, 0, 0.1), 0 1px 2px rgba(0, 0, 0, 0.06);
            transition: background-color 0.3s ease, transform 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 44px; /* تم تعديل الحجم */
            height: 44px; /* تم تعديل الحجم */
        }
        .fab-button:hover {
            background-color: #0056b3;
            transform: translateY(-1.5px);
        }
        .fab-button svg {
            width: 20px; /* تم تعديل الحجم */
            height: 20px; /* تم تعديل الحجم */
        }
        .scroll-to-top-fab {
            background-color: #28A745;
        }
        .scroll-to-top-fab:hover {
            background-color: #218838;
        }
        /* Dark Mode Styles */
        .dark-mode {
            background-color: #1A202C;
            color: #E2E8F0;
        }
        .dark-mode .header-bg {
            background-color: #2D3748;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
        }
        .dark-mode .sidebar {
            background-color: #2D3748;
            color: #E2E8F0;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.4);
        }
        .dark-mode .sidebar-nav-item {
            color: #CBD5E0;
            border-bottom: 1px solid #4A5568;
        }
        .dark-mode .sidebar-nav-item:hover, .dark-mode .sidebar-nav-item.active {
            background-color: #4A5568;
            color: #007BFF;
        }
        .dark-mode .card {
            background-color: #2D3748;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
            border-color: #4A5568;
        }
        .dark-mode .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.5);
        }
        .dark-mode .question-text {
            color: #E2E8F0;
        }
        .dark-mode .action-button {
            background-color: #4299E1;
            box-shadow: 0 4px 8px rgba(66, 153, 225, 0.3);
        }
        .dark-mode .action-button:hover {
            background-color: #3182CE;
            box-shadow: 0 6px 12px rgba(66, 153, 225, 0.4);
        }
        .dark-mode .answer-text {
            color: #68D391;
        }
        .dark-mode .mcq-option {
            background-color: #4A5568;
            border-color: #6A758D;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }
        .dark-mode .mcq-option:hover {
            background-color: #2D3748;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }
        .dark-mode .mcq-option label {
            color: #E2E8F0;
        }
        .dark-mode .mcq-option label::before {
            border-color: #4299E1;
            background: #2D3748;
        }
        .dark-mode .mcq-option label::after {
            background: #4299E1;
        }
        .dark-mode .mcq-option input[type="radio"]:checked + label::before {
            border-color: #4299E1;
            background-color: #2A4365;
        }
        .dark-mode .mcq-option:hover label::before {
            border-color: #3182CE;
        }
        .dark-mode .mcq-option.selected-for-review label::before,
        .dark-mode .mcq-option.correct-for-review label::before {
            border-color: #4299E1;
            background-color: #2A4365;
        }
        .dark-mode .mcq-option.selected-for-review label::after,
        .dark-mode .mcq-option.correct-for-review label::after {
            background: #4299E1;
        }
        .dark-mode .mcq-option.selected-for-review.option-incorrect-highlight label::before {
            border-color: #E53E3E;
            background-color: #C53030;
        }
        .dark-mode .mcq-option.selected-for-review.option-incorrect-highlight label::after {
            background: #E53E3E;
        }
        .dark-mode .score-display {
            color: #E2E8F0;
        }
        .dark-mode .final-score-message {
            color: #4299E1;
        }
        .dark-mode .correct-answer-highlight {
            color: #68D391;
        }
        .dark-mode .incorrect-answer-highlight {
            color: #FC8181;
        }
        .dark-mode .option-correct-highlight {
            background-color: #2F855A;
            border-color: #38A169;
        }
        .dark-mode .option-incorrect-highlight {
            background-color: #C53030;
            border-color: #E53E3E;
        }
        .dark-mode footer {
            border-color: #4A5568;
        }
        .dark-mode footer p {
            color: #A0AEC0;
        }

        /* New styles for font size buttons and toggle switch */
        .header-actions {
            display: flex;
            align-items: center;
            gap: 0.5rem; 
        }
        .font-size-button {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem; /* تم تكبير الخط */
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s ease;
            width: 36px; /* تم تكبير الأبعاد */
            height: 36px; /* تم تكبير الأبعاد */
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            margin: 0;
            padding: 0.25rem;
        }
        .font-size-button:hover {
            transform: scale(1.1);
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 44px; /* تم تكبير الأبعاد */
            height: 26px; /* تم تكبير الأبعاد */
            margin: 0;
        }
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px; /* تم تكبير الدائرة الداخلية */
            width: 22px; /* تم تكبير الدائرة الداخلية */
            left: 2px;
            bottom: 2px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .toggle-slider {
            background-color: #2196F3;
        }
        input:checked + .toggle-slider:before {
            transform: translateX(18px); /* تم تعديل مسافة التحريك */
        }
        .dark-mode .toggle-slider {
            background-color: #4A5568;
        }
        .dark-mode input:checked + .toggle-slider {
            background-color: #4299E1;
        }
        .dark-mode .toggle-slider:before {
            background-color: #E2E8F0;
        }
        
        @media (max-width: 768px) {
            .header-bg h1 {
                font-size: 1.1rem; /* تم تعديل الحجم */
            }
        }
    </style>
</head>
<body class="dark-mode">

    <header class="header-bg text-white p-4 shadow-md">
        <div class="hamburger-menu" id="hamburger-menu">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="h-6 w-6">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
            </svg>
        </div>
        <h1 class="text-xl md:text-2xl font-bold">Educational Platform</h1>
        <div class="header-actions">
            <button id="font-size-decrease" class="font-size-button">-</button>
            <button id="font-size-increase" class="font-size-button">+</button>
            <label class="toggle-switch">
                <input type="checkbox" id="dark-mode-toggle" checked>
                <span class="toggle-slider"></span>
            </label>
        </div>
    </header>

    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2 class="text-center font-bold">Menu</h2>
        </div>
        <nav class="flex flex-col flex-grow">
            <div class="sidebar-nav-item" data-section="tutorial-1">Tutorial 1</div>
            <div class="sidebar-nav-item" data-section="tutorial-2">Tutorial 2</div>
            <div class="sidebar-nav-item" data-section="tutorial-3">Tutorial 3</div>
            <div class="sidebar-nav-item" data-section="tutorial-4">Tutorial 4</div>
            <div class="sidebar-nav-item" data-section="tutorial-6">Tutorial 6</div>
            <div class="sidebar-nav-item" data-section="tutorial-7">Tutorial 7</div>
        </nav>
    </aside>
    <div class="sidebar-backdrop" id="sidebar-backdrop"></div>

    <main class="container mx-auto p-4 md:p-8 main-container">
        <section id="tutorial-1-section" class="question-section">
            <h2 class="section-title text-2xl font-bold mb-6 text-gray-800 text-center">Tutorial 1: Intro to Software Engineering & Processes</h2>
            <div id="tutorial-1-container"></div>
            <div class="text-center">
                <button id="show-all-tutorial-1" class="action-button mx-auto">عرض الإجابات الصحيحة</button>
                <div id="tutorial-1-score-display" class="score-display mt-4"></div>
                <div id="tutorial-1-final-score-message" class="final-score-message hidden"></div>
                <button id="review-incorrect-button-tutorial-1" class="action-button mt-4 hidden mx-auto">Review Incorrect Answers</button>
            </div>
        </section>

        <section id="tutorial-2-section" class="question-section hidden">
            <h2 class="section-title text-2xl font-bold mb-6 text-gray-800 text-center">Tutorial 2: Software Requirements & Engineering</h2>
            <div id="tutorial-2-container"></div>
            <div class="text-center">
                <button id="show-all-tutorial-2" class="action-button mx-auto">عرض الإجابات الصحيحة</button>
                <div id="tutorial-2-score-display" class="score-display mt-4"></div>
                <div id="tutorial-2-final-score-message" class="final-score-message hidden"></div>
                <button id="review-incorrect-button-tutorial-2" class="action-button mt-4 hidden mx-auto">Review Incorrect Answers</button>
            </div>
        </section>

        <section id="tutorial-3-section" class="question-section hidden">
            <h2 class="section-title text-2xl font-bold mb-6 text-gray-800 text-center">Tutorial 3: Architectural Patterns</h2>
            <div id="tutorial-3-container"></div>
            <div class="text-center">
                <button id="show-all-tutorial-3" class="action-button mx-auto">عرض الإجابات الصحيحة</button>
                <div id="tutorial-3-score-display" class="score-display mt-4"></div>
                <div id="tutorial-3-final-score-message" class="final-score-message hidden"></div>
                <button id="review-incorrect-button-tutorial-3" class="action-button mt-4 hidden mx-auto">Review Incorrect Answers</button>
            </div>
        </section>

        <section id="tutorial-4-section" class="question-section hidden">
            <h2 class="section-title text-2xl font-bold mb-6 text-gray-800 text-center">Tutorial 4: Activity Diagrams</h2>
            <div id="tutorial-4-container"></div>
            <div class="text-center">
                <button id="show-all-tutorial-4" class="action-button mx-auto">عرض الإجابات الصحيحة</button>
                <div id="tutorial-4-score-display" class="score-display mt-4"></div>
                <div id="tutorial-4-final-score-message" class="final-score-message hidden"></div>
                <button id="review-incorrect-button-tutorial-4" class="action-button mt-4 hidden mx-auto">Review Incorrect Answers</button>
            </div>
        </section>

        <section id="tutorial-6-section" class="question-section hidden">
            <h2 class="section-title text-2xl font-bold mb-6 text-gray-800 text-center">Tutorial 6: Use-Case Models</h2>
            <div id="tutorial-6-container"></div>
            <div class="text-center">
                <button id="show-all-tutorial-6" class="action-button mx-auto">عرض الإجابات الصحيحة</button>
                <div id="tutorial-6-score-display" class="score-display mt-4"></div>
                <div id="tutorial-6-final-score-message" class="final-score-message hidden"></div>
                <button id="review-incorrect-button-tutorial-6" class="action-button mt-4 hidden mx-auto">Review Incorrect Answers</button>
            </div>
        </section>

        <section id="tutorial-7-section" class="question-section hidden">
            <h2 class="section-title text-2xl font-bold mb-6 text-gray-800 text-center">Tutorial 7: Introduction to Software Testing</h2>
            <div id="tutorial-7-container"></div>
            <div class="text-center">
                <button id="show-all-tutorial-7" class="action-button mx-auto">عرض الإجابات الصحيحة</button>
                <div id="tutorial-7-score-display" class="score-display mt-4"></div>
                <div id="tutorial-7-final-score-message" class="final-score-message hidden"></div>
                <button id="review-incorrect-button-tutorial-7" class="action-button mt-4 hidden mx-auto">Review Incorrect Answers</button>
            </div>
        </section>

        <footer class="text-center mt-10 py-5 border-t border-gray-300">
            <div class="container mx-auto text-gray-600">
                <p>&copy; 2024 Educational Platform. All rights reserved.</p>
                <p class="text-sm text-gray-500">The provided data is for illustrative and educational purposes only.</p>
            </div>
        </footer>

    </main>

    <div class="fab-container">
        <button id="scroll-to-top-button" class="fab-button scroll-to-top-fab">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />
            </svg>
        </button>
    </div>

    <script>
        // --- DATA ---
        // All quiz questions and answers are stored here.
        const quizData = {
            'tutorial-1': {
                data: [
                    { type: 'mcq', q: "The types of software maintenance are:", options: ["a) Corrective, Adaptive, Perfective, and Predictive", "b) Corrective, Adaptive, Perfective, and Preventative", "c) Corrective, Proactive, Reactive, and Adaptive", "d) Corrective, Preventive, Corrective, and Perfective"], correct: 1 },
                    { type: 'mcq', q: "The main objective of Adaptive Maintenance is:", options: ["a) Fixing bugs", "b) Meeting new requirements", "c) Altering software to fit changing software.", "d) Reducing further maintenance needs"], correct: 2 },
                    { type: 'mcq', q: "The primary goal of perfective maintenance is:", options: ["a) Fixing bugs", "b) Meeting new requirements", "c) Reducing further maintenance", "d) Adapting to changing environments"], correct: 1 },
                    { type: 'mcq', q: "Preventative is a type of maintenance that involves:", options: ["a) Fixing bugs", "b) Altering software to fit changing software", "c) Meeting new requirements", "d) Reducing further maintenance needs"], correct: 3 },
                    { type: 'mcq', q: "The primary purpose of the Software Development Life Cycle (SDLC) is to:", options: ["a) Design software only", "b) Provide a structured process for developing high-quality software", "c) Focus only on testing", "d) Reduce costs in the development phase"], correct: 1 },
                    { type: 'mcq', q: "SDLC specifies the tasks performed at various stages by a:", options: ["a) Project manager", "b) Software engineer or developer", "c) Quality assurance tester", "d) Business analyst"], correct: 1 },
                    { type: 'mcq', q: "The SDLC ensures that the product meets:", options: ["a) Developer's preferences", "b) Budget constraints only", "c) Customer expectations", "d) Industry standards only"], correct: 2 },
                    { type: 'mcq', q: "Planning and Requirement Analysis stage involves gathering information to:", options: ["a) Design the software architecture", "b) Create the basic plan for the project", "c) Deploy the software", "d) Test the software"], correct: 1 },
                    { type: 'mcq', q: "The purpose of the Planning and Requirement Analysis stage is to:", options: ["a) Design the software", "b) Understand what is needed for the project.", "c) Test the software", "d) Deploy the software"], correct: 1 },
                    { type: 'mcq', q: "Stage-3: Designing Architecture involves:", options: ["a) Creating test cases", "b) Selecting the best design idea from the DDS", "c) Deploying the product", "d) Gathering initial requirements"], correct: 1 },
                    { type: 'mcq', q: "The DDS document is used to:", options: ["a) List down software requirements", "b) Design the software architecture", "c) Test the software", "d) Deploy the software"], correct: 1 },
                    { type: 'mcq', q: "DDS (Design Document Specification) document contains:", options: ["a) Final code", "b) User manuals", "c) Different ideas for building the software.", "d) Test results"], correct: 2 },
                    { type: 'mcq', q: "Product Testing and Integration stage of SDLC involves:", options: ["a) Gathering client feedback", "b) Creating test cases and executing them.", "c) Defining requirements", "d) Designing architecture"], correct: 1 },
                    { type: 'mcq', q: "The purpose of testing in the SDLC is to:", options: ["a) Design the software", "b) Ensure the software works as expected", "c) Gather client requirements", "d) Deploy the software"], correct: 1 },
                    { type: 'mcq', q: "The Product Testing and Integration stage is used to:", options: ["a) Deploy the software", "b) Find and fix mistakes in the software", "c) Design the software", "d) Gather client feedback"], correct: 1 },
                    { type: 'mcq', q: "Product testing is compared to testing a car before selling it to ensure the software meets:", options: ["a) Performance benchmarks", "b) Market demand", "c) Quality standards", "d) User interface guidelines"], correct: 2 },
                    { type: 'mcq', q: "Which of the following is NOT a stage in the SDLC?", options: ["a) Planning and Requirement Analysis", "b) Client Feedback Collection", "c) Designing Architecture", "d) Developing Product"], correct: 1 },
                    { type: 'mcq', q: "The relation between testing and maintenance is that Maintenance begins after:", options: ["a) Deployment", "b) Testing identifies issues", "c) Design is complete", "d) Requirements are gathered"], correct: 1 },
                    { type: 'mcq', q: "In agile processes, planning is incremental, and it is easier to change the process to reflect:", options: ["a) Fixed deadlines", "b) Stable requirements", "c) Changing customer requirements.", "d) Internal team preferences"], correct: 2 },
                    { type: 'mcq', q: "The main goal of software maintenance is to:", options: ["a) Design the software", "b) Ensure the software continues to work well after release", "c) Gather client requirements", "d) Deploy the software"], correct: 1 },
                    { type: 'mcq', q: "Waterfall Model does not adapt well to uncertain projects because:", options: ["a) It is too simple", "b) It requires stable requirements.", "c) It focuses on documentation", "d) It emphasizes testing"], correct: 1 },
                    { type: 'mcq', q: "Waterfall model is known as a:", options: ["a) Agile life cycle model", "b) Linear-sequential life cycle model", "c) Iterative life cycle model", "d) Spiral life cycle model"], correct: 1 },
                    { type: 'mcq', q: "Which of the following is a disadvantage of the Waterfall Model?", options: ["a) Clear Milestones", "b) Flexibility to Changes", "c) Stable Requirements", "d) Inflexibility to Changes"], correct: 3 },
                    { type: 'mcq', q: "The system of Incremental development is a series of:", options: ["a) Single, large releases", "b) Versions (increments), with each version adding functionality to the previous version.", "c) Unrelated modules", "d) Prototypes that are discarded"], correct: 1 } ] }, 'tutorial-2': { data: [ { type: 'mcq', q: "A requirement may range from a high-level abstract statement of a service to a detailed __________ functional specification.", options: ["a) conceptual", "b) mathematical", "c) graphical", "d) textual"], correct: 1 }, { type: 'mcq', q: "Software engineering is an engineering discipline that is concerned with all aspects of __________.", options: ["a) hardware production", "b) software production", "c) network infrastructure", "d) database management"], correct: 1 }, { type: 'mcq', q: "Requirements engineering is a subset of systems engineering concerned with defining the system at __________ levels of abstraction.", options: ["a) initial", "b) final", "c) successive", "d) single"], correct: 2 }, { type: 'mcq', q: "__________ are the essential activities for developing the software.", options: ["a) User Requirements", "b) Business Requirements", "c) Functional Requirements", "d) Non-Functional Requirements"], correct: 1 }, { type: 'mcq', q: "__________ describes for the customers/users the services the system provides and its operational constraints.", options: ["a) Business Requirements", "b) Functional Requirements", "c) User Requirements", "d) Domain Requirements"], correct: 2 }, { type: 'mcq', q: "Functional Requirements describes __________ the software should do.", options: ["a) how", "b) why", "c) what", "d) when"], correct: 2 }, { type: 'mcq', q: "Non-Functional Requirements describes software __________.", options: ["a) functions", "b) features", "c) properties", "d) algorithms"], correct: 2 }, { type: 'mcq', q: "Domain requirements describes constraints on the system from __________ of operation.", options: ["a) user interface", "b) performance", "c) security", "d) domain"], correct: 3 }, { type: 'mcq', q: "Stated requirements are provided by a user/customer at the beginning of a __________ development.", options: ["a) hardware", "b) software", "c) network", "d) business process"], correct: 1 } ] }, 'tutorial-3': { data: [ { type: 'mcq', q: "Validation (Testing) is important for checking that it does __________.", options: ["a) what the developer wants", "b) what the customer wants", "c) what the system can do", "d) what the budget allows"], correct: 1 }, { type: 'mcq', q: "Maintenance & Evolution is used for __________ the system in response to changing customer needs.", options: ["a) designing", "b) deploying", "c) changing", "d) testing"], correct: 2 }, { type: 'mcq', q: "Reuse in Software Engineering is used to avoid duplication of effort for problems already have existing solutions, which saves __________.", options: ["a) time only", "b) money only", "c) resources", "d) effort only"], correct: 2 }, { type: 'mcq', q: "A pattern is the outline of a reusable solution to a __________ problem encountered in a particular context.", options: ["a) unique", "b) recurring", "c) complex", "d) simple"], correct: 1 }, { type: 'mcq', q: "Patterns provide common language between developers to improve software quality and reduce __________.", options: ["a) testing time", "b) deployment time", "c) development time", "d) maintenance costs"], correct: 2 }, { type: 'mcq', q: "It is important to ensure that the architecture satisfies the software requirements, both functional (What the software should do) and nonfunctional (__________ ).", options: ["a) When the software should do it", "b) Who uses the software", "c) How the software should perform", "d) The software's brand name"], correct: 2 }, { type: 'mcq', q: "Architectural patterns are similar to software __________.", options: ["a) algorithms", "b) methods", "c) design patterns", "d) methodologies"], correct: 2 }, { type: 'mcq', q: "What is an architectural pattern?", options: ["a) A single piece of code", "b) A reusable solution to a recurring problem", "c) A user interface layout", "d) A programming language"], correct: 1 }, { type: 'mcq', q: "Which of the following is an example of an architectural pattern?", options: ["a) The Singleton pattern", "b) The Adapter pattern", "c) The Model-View-Controller (MVC) pattern", "d) The Observer pattern"], correct: 2 }, { type: 'mcq', q: "What is the primary role of the Model in the MVC pattern?", options: ["a) To display data to the user", "b) To manage the application's data and business logic", "c) To handle user input", "d) To define the architectural structure"], correct: 1 }, { type: 'mcq', q: "In the MVC pattern, the Controller acts as the __________ between the Model and the View.", options: ["a) data storage", "b) user interface", "c) intermediary", "d) presentation layer"], correct: 2 }, { type: 'mcq', q: "The View in the MVC pattern is responsible for __________.", options: ["a) handling user input", "b) managing the application's data", "c) displaying the data from the Model", "d) communicating with the database"], correct: 2 }, { type: 'mcq', q: "What is a major benefit of using the MVC pattern?", options: ["a) It tightly couples the Model, View, and Controller", "b) It makes the code difficult to maintain", "c) It allows for a clear separation of concerns", "d) It is only suitable for small projects"], correct: 2 } ] }, 'tutorial-4': { data: [ { type: 'mcq', q: "Activity Diagrams are used in UML to describe a system's __________.", options: ["a) static structure", "b) behavioral aspects", "c) deployment environment", "d) data flow"], correct: 1 }, { type: 'mcq', q: "The main purpose of an Activity Diagram is to model the __________ of activities.", options: ["a) sequence", "b) data", "c) components", "d) classes"], correct: 1 }, { type: 'mcq', q: "What shape represents a start point in an Activity Diagram?", options: ["a) A square", "b) A solid circle", "c) A diamond", "d) A cylinder"], correct: 1 }, { type: 'mcq', q: "What shape represents a final point in an Activity Diagram?", options: ["a) A solid circle inside a hollow circle", "b) A hollow circle", "c) A diamond", "d) An oval"], correct: 0 }, { type: 'mcq', q: "An Activity is represented by a __________ with rounded corners.", options: ["a) circle", "b) rectangle", "c) square", "d) diamond"], correct: 1 }, { type: 'mcq', q: "A Swimlane is used to group activities performed by a specific __________.", options: ["a) time", "b) location", "c) actor", "d) process"], correct: 2 }, { type: 'mcq', q: "A Fork node is used to represent a point where a single flow of control splits into __________ flows.", options: ["a) single", "b) sequential", "c) concurrent", "d) alternating"], correct: 2 }, { type: 'mcq', q: "A Join node is used to represent a point where __________ flows of control merge.", options: ["a) single", "b) concurrent", "c) alternating", "d) sequential"], correct: 1 }, { type: 'mcq', q: "A Decision node is represented by a __________.", options: ["a) square", "b) circle", "c) diamond", "d) rectangle"], correct: 2 }, { type: 'mcq', q: "An arrow from an activity to a Decision node represents a __________.", options: ["a) flow", "b) choice", "c) condition", "d) split"], correct: 0 }, { type: 'mcq', q: "The two types of arrows in an Activity Diagram are __________ and __________.", options: ["a) solid, dashed", "b) straight, curved", "c) control flow, object flow", "d) start, end"], correct: 2 }, { type: 'mcq', q: "What is the primary purpose of a Swimlane?", options: ["a) To show the sequence of events", "b) To represent decisions", "c) To partition activities by actor or responsibility", "d) To show concurrent activities"], correct: 2 } ] }, 'tutorial-6': { data: [ { type: 'mcq', q: "A Use-Case Model describes the functions of a system as perceived by an __________.", options: ["a) developer", "b) actor", "c) administrator", "d) end user"], correct: 1 }, { type: 'mcq', q: "In a Use-Case Model, an Actor is a role played by a user or an external __________ that interacts with the system.", options: ["a) process", "b) component", "c) system", "d) database"], correct: 2 }, { type: 'mcq', q: "A Use-Case represents a sequence of actions that a system performs to yield a valuable result to a specific __________.", options: ["a) designer", "b) developer", "c) actor", "d) manager"], correct: 2 }, { type: 'mcq', q: "A Use-Case Diagram is a graphical representation of the interactions between __________ and __________.", options: ["a) classes, objects", "b) actors, use-cases", "c) components, interfaces", "d) data, processes"], correct: 1 }, { type: 'mcq', q: "What is the symbol for an Actor in a Use-Case Diagram?", options: ["a) A stick figure", "b) A circle", "c) A rectangle", "d) A diamond"], correct: 0 }, { type: 'mcq', q: "What is the symbol for a Use-Case in a Use-Case Diagram?", options: ["a) A square", "b) An oval", "c) A stick figure", "d) A line"], correct: 1 }, { type: 'mcq', q: "An association between an Actor and a Use-Case is represented by a __________ line.", options: ["a) dashed", "b) dotted", "c) solid", "d) zigzag"], correct: 2 }, { type: 'mcq', q: "The 'include' relationship is used when a use-case includes the functionality of another use-case as a mandatory part of its __________.", options: ["a) pre-condition", "b) post-condition", "c) behavior", "d) extension"], correct: 2 }, { type: 'mcq', q: "The 'extend' relationship is used when a use-case extends the functionality of another use-case under a specific __________.", options: ["a) condition", "b) scenario", "c) time", "d) requirement"], correct: 0 }, { type: 'mcq', q: "In a Use-Case Diagram, the system boundary is represented by a __________.", options: ["a) circle", "b) dashed line", "c) rectangle", "d) triangle"], correct: 2 } ] }, 'tutorial-7': { data: [ { type: 'mcq', q: "Software testing is a process of evaluating a software product to check if it matches the actual __________.", options: ["a) design", "b) code", "c) requirements", "d) performance"], correct: 2 }, { type: 'mcq', q: "The main goal of testing is to identify __________ in the software.", options: ["a) features", "b) requirements", "c) defects", "d) algorithms"], correct: 2 }, { type: 'mcq', q: "What is a software defect?", options: ["a) An intentional bug", "b) A flaw or error that causes the software to fail", "c) A feature request", "d) An aesthetic issue"], correct: 1 }, { type: 'mcq', q: "The two main types of testing are Functional Testing and __________ Testing.", options: ["a) System", "b) Unit", "c) Regression", "d) Non-Functional"], correct: 3 }, { type: 'mcq', q: "Functional Testing is concerned with the system's __________.", options: ["a) performance", "b) security", "c) features and functions", "d) usability"], correct: 2 }, { type: 'mcq', q: "Non-Functional Testing is concerned with the system's __________.", options: ["a) what it does", "b) how it performs", "c) what it looks like", "d) its business value"], correct: 1 }, { type: 'mcq', q: "The two main approaches to testing are Black-Box Testing and __________ Testing.", options: ["a) White-Box", "b) Grey-Box", "c) Green-Box", "d) Red-Box"], correct: 0 }, { type: 'mcq', q: "Black-Box Testing is also known as __________-based testing.", options: ["a) code", "b) structure", "c) functionality", "d) requirement"], correct: 2 }, { type: "mcq", "q": "In Black-Box Testing, the tester has no knowledge of the internal __________ or structure of the software.", "options": ["a) code", "b) design", "c) functionality", "d) requirements"], "correct": 0 }, { "type": "mcq", "q": "White-Box Testing is also known as __________-based testing.", "options": ["a) functionality", "b) external", "c) internal", "d) code"], "correct": 3 }, { "type": "mcq", "q": "In White-Box Testing, the tester has knowledge of the internal __________ and structure of the software.", "options": ["a) design", "b) user interface", "c) business logic", "d) code"], "correct": 0 }, { "type": "mcq", "q": "What is Unit Testing?", "options": ["a) Testing the entire system", "b) Testing individual components or units of a software", "c) Testing the integration between components", "d) Testing the user interface"], "correct": 1 }, { "type": "mcq", "q": "Integration Testing is the process of testing the __________ between different modules or components.", "options": ["a) code", "b) interfaces", "c) design", "d) functionality"], "correct": 1 }, { "type": "mcq", "q": "System Testing involves testing the entire and fully __________ system.", "options": ["a) designed", "b) integrated", "c) deployed", "d) coded"], "correct": 1 }, { "type": "mcq", "q": "Acceptance Testing is done to check if the system meets the __________'s requirements.", "options": ["a) developer", "b) manager", "c) client", "d) tester"], "correct": 2 }, { "type": "mcq", "q": "Regression Testing is done to ensure that new changes or additions to the software have not introduced any new __________.", "options": ["a) features", "b) defects", "c) requirements", "d) bugs"], "correct": 1 }, { "type": "mcq", "q": "Smoke Testing is a preliminary test to ensure that the most important __________ of the software are working.", "options": ["a) features", "b) bugs", "c) defects", "d) requirements"], "correct": 0 }, { "type": "mcq", "q": "What is the primary goal of Smoke Testing?", "options": ["a) To find all possible bugs", "b) To ensure the software is stable enough for further testing", "c) To test all features in detail", "d) To test the user interface"], "correct": 1 }, { "type": "mcq", "q": "Static Testing is a type of testing where the software is not __________.", "options": ["a) deployed", "b) run", "c) designed", "d) coded"], "correct": 1 }, { "type": "mcq", "q": "What is an example of Static Testing?", "options": ["a) Running the software with test cases", "b) Reviewing the code and documents", "c) Testing the user interface", "d) Deploying the software"], "correct": 1 }, { "type": "mcq", "q": "What is Dynamic Testing?", "options": ["a) Testing the software's documentation", "b) Testing the software by running it", "c) Testing the software's design", "d) Testing the software's requirements"], "correct": 1 }, { "type": "mcq", "q": "What is an example of Dynamic Testing?", "options": ["a) Code review", "b) Requirements analysis", "c) Running a test script on the software", "d) Documenting the system architecture"], "correct": 2 } ] }
        };

        // --- GLOBAL STATE & DOM ELEMENTS ---
        const currentQuiz = {
            tutorial: 'tutorial-1',
            incorrectAnswers: []
        };
        const incorrectAnswers = new Map(); // Using a Map to easily manage unique incorrect answers.

        const sidebar = document.getElementById('sidebar');
        const hamburgerMenu = document.getElementById('hamburger-menu');
        const sidebarBackdrop = document.getElementById('sidebar-backdrop');
        const navItems = document.querySelectorAll('.sidebar-nav-item');
        const sections = document.querySelectorAll('.question-section');

        // --- LOCAL STORAGE FUNCTIONS ---

        // Saves the current state (incorrect answers, current tutorial) to localStorage.
        function saveQuizState() {
            localStorage.setItem('incorrectAnswers', JSON.stringify(Array.from(incorrectAnswers.entries())));
            localStorage.setItem('currentQuiz', JSON.stringify(currentQuiz));
        }

        // Loads the state from localStorage when the page loads.
        function loadQuizState() {
            const storedIncorrectAnswers = localStorage.getItem('incorrectAnswers');
            const storedCurrentQuiz = localStorage.getItem('currentQuiz');

            if (storedIncorrectAnswers) {
                const parsedIncorrect = new Map(JSON.parse(storedIncorrectAnswers));
                for (const [key, value] of parsedIncorrect) {
                    incorrectAnswers.set(key, value);
                }
            }

            if (storedCurrentQuiz) {
                const parsedCurrent = JSON.parse(storedCurrentQuiz);
                currentQuiz.tutorial = parsedCurrent.tutorial || 'tutorial-1'; // Fallback
                currentQuiz.incorrectAnswers = parsedCurrent.incorrectAnswers || [];
            }
        }

        // --- QUIZ RENDERING & LOGIC ---

        // Gets the correct container ID for a given tutorial key.
        function getContainerId(tutorialKey) {
            // Note: We use the same container for both quizzes and incorrect answers.
            // The section ID is used to show/hide the correct part of the page.
            return `${tutorialKey}-container`;
        }

        // Dynamically creates an HTML card for a single question.
        function createQuestionCard(questionObj, questionIndex, tutorialKey, isReviewMode = false) {
            const card = document.createElement('div');
            card.className = 'card';
            card.dataset.questionIndex = questionIndex;
            card.dataset.tutorialKey = tutorialKey;

            const questionText = document.createElement('p');
            questionText.className = 'question-text';
            questionText.textContent = questionObj.q;
            card.appendChild(questionText);

            if (questionObj.type === 'mcq') {
                const optionsContainer = document.createElement('div');
                optionsContainer.className = 'options-container';

                questionObj.options.forEach((optionText, optionIndex) => {
                    const option = document.createElement('div');
                    option.className = 'mcq-option';
                    option.setAttribute('role', 'radio');
                    option.setAttribute('aria-checked', 'false');
                    option.setAttribute('tabindex', '0');
                    option.dataset.optionIndex = optionIndex;
                    
                    const input = document.createElement('input');
                    input.type = 'radio';
                    input.name = `mcq-${tutorialKey}-${questionIndex}`;
                    input.value = optionIndex;
                    input.id = `mcq-${tutorialKey}-${questionIndex}-${optionIndex}`;
                    
                    const label = document.createElement('label');
                    label.htmlFor = `mcq-${tutorialKey}-${questionIndex}-${optionIndex}`;
                    label.textContent = optionText;

                    option.appendChild(input);
                    option.appendChild(label);
                    optionsContainer.appendChild(option);

                    // If in review mode, highlight the user's previous incorrect answer and the correct answer.
                    if (isReviewMode) {
                        const incorrectQuestion = Array.from(incorrectAnswers.values()).find(item =>
                            item.tutorialKey === tutorialKey && item.questionIndex === questionIndex
                        );

                        // If user skipped (answer is null), or chose wrong, highlight their choice
                        if (incorrectQuestion) {
                            if (incorrectQuestion.userAnswer !== null && parseInt(incorrectQuestion.userAnswer) === optionIndex) {
                                option.classList.add('selected-for-review', 'option-incorrect-highlight');
                            }
                            // Always highlight the correct answer in review mode
                            if (questionObj.correct === optionIndex) {
                                option.classList.add('option-correct-highlight');
                            }
                        }
                    }
                });
                card.appendChild(optionsContainer);
            }

            // In review mode, we don't need a check button per card.
            if (!isReviewMode) {
                const checkButton = document.createElement('button');
                checkButton.className = 'action-button check-button';
                checkButton.textContent = 'عرض الإجابة';
                card.appendChild(checkButton);
            }

            const feedback = document.createElement('div');
            feedback.className = 'answer-text';
            card.appendChild(feedback);

            return card;
        }

        // Clears the quiz container before rendering new questions.
        function clearQuizContainer(containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            const tutorialKey = containerId.replace('-container', '');

            const showAllButton = document.getElementById(`show-all-${tutorialKey}`);
            const scoreDisplay = document.getElementById(`${tutorialKey}-score-display`);
            const finalScoreMessage = document.getElementById(`${tutorialKey}-final-score-message`);
            const reviewButton = document.getElementById(`review-incorrect-button-${tutorialKey}`);

            if (showAllButton) showAllButton.style.display = 'block';
            if (scoreDisplay) scoreDisplay.textContent = '';
            if (finalScoreMessage) {
                finalScoreMessage.textContent = '';
                finalScoreMessage.classList.add('hidden');
            }
            if (reviewButton) reviewButton.classList.add('hidden');
        }

        // Main function to render a quiz based on the selected tutorial.
        function renderQuiz(tutorialKey, isReviewMode = false) {
            const containerId = getContainerId(tutorialKey);
            showSection(`${tutorialKey}-section`);

            clearQuizContainer(containerId);

            const container = document.getElementById(containerId);
            const questions = isReviewMode ? Array.from(incorrectAnswers.values()).filter(item => item.tutorialKey === tutorialKey) : quizData[tutorialKey]?.data || [];

            if (questions.length === 0 && isReviewMode) {
                 container.innerHTML = `<p class="text-center text-lg">لا توجد إجابات خاطئة لمراجعتها. عمل رائع!</p>`;
            } else {
                 questions.forEach((questionData, index) => {
                    const qIndex = isReviewMode ? questionData.questionIndex : index;
                    const qObj = isReviewMode ? questionData.question : questionData;
                    const tKey = isReviewMode ? questionData.tutorialKey : tutorialKey;

                    const card = createQuestionCard(qObj, qIndex, tKey, isReviewMode);
                    container.appendChild(card);

                    // If in review mode, show the correct answer and feedback.
                    if (isReviewMode) {
                        showAnswer(card, qObj, true);
                    }
                });
            }

            // Hide check all buttons if in review mode
            const showAllButton = document.getElementById(`show-all-${tutorialKey}`);
            if (showAllButton) {
                showAllButton.classList.toggle('hidden', isReviewMode);
            }

            // Attach event listeners to the individual 'Check Answer' buttons.
            container.querySelectorAll('.check-button').forEach(button => {
                button.addEventListener('click', (e) => {
                    const card = e.target.closest('.card');
                    const tutorial = card.dataset.tutorialKey;
                    const index = parseInt(card.dataset.questionIndex);
                    const questionObj = quizData[tutorial].data[index];
                    showAnswer(card, questionObj);
                });
            });

            // Add new click listener for the whole mcq-option
            container.querySelectorAll('.mcq-option').forEach(option => {
                option.addEventListener('click', () => {
                    const radio = option.querySelector('input[type="radio"]');
                    if (radio) {
                        radio.checked = true;
                        // For accessibility, update the role
                        option.setAttribute('aria-checked', 'true');
                        // Uncheck others in the same group
                        const otherOptions = option.closest('.options-container').querySelectorAll('.mcq-option');
                        otherOptions.forEach(other => {
                            if (other !== option) {
                                other.setAttribute('aria-checked', 'false');
                            }
                        });
                    }
                });
            });
        }

        // Checks a single answer and provides immediate feedback.
        function showAnswer(card, questionObj, isReviewMode = false) {
            const selectedOption = card.querySelector('input[type="radio"]:checked');
            const feedbackElement = card.querySelector('.answer-text');
            const options = card.querySelectorAll('.mcq-option');

            // First, remove any previous highlight classes.
            options.forEach(option => {
                option.classList.remove('option-correct-highlight', 'option-incorrect-highlight');
            });

            // Highlight the correct answer.
            const correctOption = options[questionObj.correct];
            if (correctOption) {
                correctOption.classList.add('option-correct-highlight');
            }

            if (selectedOption) {
                const selectedAnswerIndex = parseInt(selectedOption.value);
                const isCorrect = selectedAnswerIndex === questionObj.correct;

                if (!isCorrect) {
                    const selectedOptionElement = options[selectedAnswerIndex];
                    if (selectedOptionElement) {
                        selectedOptionElement.classList.add('option-incorrect-highlight');
                    }
                }

                feedbackElement.style.display = 'block';
                if (isCorrect) {
                    feedbackElement.innerHTML = `<span class="correct-answer-highlight">إجابة صحيحة!</span>`;
                } else {
                    feedbackElement.innerHTML = `<span class="incorrect-answer-highlight">إجابة خاطئة. الإجابة الصحيحة هي: ${questionObj.options[questionObj.correct]}</span>`;
                }

            } else {
                feedbackElement.style.display = 'block';
                feedbackElement.innerHTML = `<span class="incorrect-answer-highlight">الإجابة الصحيحة هي: ${questionObj.options[questionObj.correct]}</span>`;
            }

            if (isReviewMode) {
                // In review mode, we also need to highlight the user's selected answer if it was incorrect
                const incorrectQuestion = Array.from(incorrectAnswers.values()).find(item =>
                    item.tutorialKey === card.dataset.tutorialKey && item.questionIndex === parseInt(card.dataset.questionIndex)
                );
                if (incorrectQuestion && incorrectQuestion.userAnswer !== null) {
                    const selectedOptionElement = card.querySelector(`.mcq-option input[value="${incorrectQuestion.userAnswer}"]`).closest('.mcq-option');
                    if (selectedOptionElement) {
                         selectedOptionElement.classList.add('option-incorrect-highlight');
                    }
                }
            }
        }

        // Checks all answers and calculates the score.
        function checkAnswers(tutorialKey) {
            const container = document.getElementById(getContainerId(tutorialKey));
            const questions = quizData[tutorialKey].data;
            let score = 0;
            
            // Clear previous incorrect answers for this tutorial before re-checking
            const keysToRemove = Array.from(incorrectAnswers.keys()).filter(key => key.startsWith(tutorialKey));
            keysToRemove.forEach(key => incorrectAnswers.delete(key));

            questions.forEach((questionObj, index) => {
                const card = container.querySelector(`.card[data-question-index="${index}"]`);
                const selectedOption = card.querySelector('input[type="radio"]:checked');

                const isCorrect = selectedOption && parseInt(selectedOption.value) === questionObj.correct;
                const incorrectKey = `${tutorialKey}-${index}`;

                if (isCorrect) {
                    score++;
                } else {
                    incorrectAnswers.set(incorrectKey, {
                        tutorialKey: tutorialKey,
                        questionIndex: index,
                        question: questionObj,
                        userAnswer: selectedOption ? selectedOption.value : null
                    });
                }
            });

            // Update the score display
            const scoreDisplay = document.getElementById(`${tutorialKey}-score-display`);
            scoreDisplay.textContent = `أنت حصلت على ${score} من ${questions.length}.`;
            
            const finalScoreMessage = document.getElementById(`${tutorialKey}-final-score-message`);
            const reviewButton = document.getElementById(`review-incorrect-button-${tutorialKey}`);
            
            if (score === questions.length) {
                finalScoreMessage.textContent = 'عمل رائع! جميع الإجابات صحيحة!';
                finalScoreMessage.classList.remove('hidden');
                reviewButton.classList.add('hidden');
            } else {
                finalScoreMessage.textContent = `لديك ${questions.length - score} إجابات خاطئة.`;
                finalScoreMessage.classList.remove('hidden');
                reviewButton.classList.remove('hidden');
            }

            saveQuizState(); // Save state after checking answers.
        }

        // Displays correct answers for all questions on the page.
        function showAllAnswers(tutorialKey) {
            checkAnswers(tutorialKey); // First, check all answers to get the score and save incorrect ones.
            const container = document.getElementById(getContainerId(tutorialKey));
            const questionCards = container.querySelectorAll('.card');
            
            questionCards.forEach(card => {
                const index = parseInt(card.dataset.questionIndex);
                const questionObj = quizData[tutorialKey].data[index];
                showAnswer(card, questionObj);
            });

            // Hide the 'Show All Answers' button after it's clicked.
            const showAllButton = document.getElementById(`show-all-${tutorialKey}`);
            if (showAllButton) {
                showAllButton.style.display = 'none';
            }
        }


        // --- UI & NAVIGATION ---

        // Highlights the active navigation item in the sidebar.
        function setActiveNavItem(sectionKey) {
            navItems.forEach(item => {
                item.classList.toggle('active', item.dataset.section === sectionKey);
            });
        }

        // Shows the relevant section and hides others.
        function showSection(sectionId) {
            sections.forEach(section => section.classList.add('hidden'));
            const sectionToShow = document.getElementById(sectionId);
            if (sectionToShow) {
                sectionToShow.classList.remove('hidden');
            }
        }

        // Handles clicks on sidebar navigation items.
        function handleSidebarNavigation(sectionKey, isReviewMode = false) {
            setActiveNavItem(sectionKey);
            currentQuiz.tutorial = sectionKey;
            
            // Render quiz questions or review of incorrect answers in the same container.
            renderQuiz(sectionKey, isReviewMode);
            
            // Close sidebar after selection for a better mobile experience.
            sidebar.classList.remove('active');
            sidebarBackdrop.classList.remove('active');

            // Scroll to the top of the section
            const section = document.getElementById(`${sectionKey}-section`);
            if (section) {
                section.scrollIntoView({ behavior: 'smooth' });
            }
        }

        // --- INITIALIZATION ---

        // This function runs when the page has finished loading.
        window.onload = () => {
            loadQuizState();

            // Render the last viewed tutorial or the first one by default.
            handleSidebarNavigation(currentQuiz.tutorial);

            // --- EVENT LISTENERS ---

            // Sidebar navigation
            navItems.forEach(item => {
                item.addEventListener('click', () => {
                    const sectionKey = item.dataset.section;
                    handleSidebarNavigation(sectionKey);
                });
            });

            // 'Show All' buttons
            document.querySelectorAll('[id^="show-all-"]').forEach(button => {
                button.addEventListener('click', () => {
                    const tutorialKey = button.id.replace('show-all-', '');
                    showAllAnswers(tutorialKey);
                });
            });

            // 'Review Incorrect' buttons
            document.querySelectorAll('[id^="review-incorrect-button-"]').forEach(button => {
                button.addEventListener('click', () => {
                    const tutorialKey = button.id.replace('review-incorrect-button-', '');
                    handleSidebarNavigation(tutorialKey, true);
                });
            });

            // Sidebar toggle logic
            hamburgerMenu.addEventListener('click', () => {
                sidebar.classList.toggle('active');
                sidebarBackdrop.classList.toggle('active');
            });

            sidebarBackdrop.addEventListener('click', () => {
                sidebar.classList.remove('active');
                sidebarBackdrop.classList.remove('active');
            });

            // Scroll to Top Button
            const scrollToTopButton = document.getElementById('scroll-to-top-button');
            window.addEventListener('scroll', () => {
                if (window.scrollY > 200) {
                    scrollToTopButton.style.display = 'flex';
                } else {
                    scrollToTopButton.style.display = 'none';
                }
            });
            scrollToTopButton.addEventListener('click', () => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });

            // Dark Mode Toggle
            const darkModeToggle = document.getElementById('dark-mode-toggle');
            darkModeToggle.addEventListener('change', () => {
                document.body.classList.toggle('dark-mode', darkModeToggle.checked);
                // Also save the state
                localStorage.setItem('darkMode', darkModeToggle.checked);
            });
            
            // Load dark mode state from local storage
            const isDarkMode = localStorage.getItem('darkMode') === 'true';
            darkModeToggle.checked = isDarkMode;
            if (isDarkMode) {
                document.body.classList.add('dark-mode');
            }


            // Font Size Controls
            const fontSizeIncreaseBtn = document.getElementById('font-size-increase');
            const fontSizeDecreaseBtn = document.getElementById('font-size-decrease');
            const htmlElement = document.documentElement;
            fontSizeIncreaseBtn.addEventListener('click', () => {
                let currentSize = parseFloat(getComputedStyle(htmlElement).fontSize);
                htmlElement.style.fontSize = (currentSize + 1) + 'px';
            });
            fontSizeDecreaseBtn.addEventListener('click', () => {
                let currentSize = parseFloat(getComputedStyle(htmlElement).fontSize);
                if (currentSize > 8) { // Prevent font from getting too small
                    htmlElement.style.fontSize = (currentSize - 1) + 'px';
                }
            });

        };
    </script>
</body>
</html>
